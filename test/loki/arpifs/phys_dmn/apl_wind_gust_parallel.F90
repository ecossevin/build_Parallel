SUBROUTINE APL_WIND_GUST_PARALLEL (YDMF_PHYS_BASE_STATE, YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDVARS, YDMODEL, YD_KMOC_CLPH,  &
& YD_PBLH, YD_PDCAPE)
  
  !**** *APL_WIND_GUST*
  
  !     Author.
  !     -------
  !      Philippe Marguinaud *METEO-FRANCE*
  !      Original : 28-04-2021
  
  USE ACPY_MOD
  USE STACK_MOD
  USE YOMPARALLELMETHOD
  USE FIELD_ACCESS_MODULE
  USE FIELD_FACTORY_MODULE
  USE FIELD_MODULE
#include "stack.h"
  USE YOMHOOK, ONLY: LHOOK, DR_HOOK, JPHOOK
  USE PARKIND1, ONLY: JPIM, JPRB
  
  USE GEOMETRY_MOD, ONLY: GEOMETRY
  USE MF_PHYS_BASE_STATE_TYPE_MOD, ONLY: MF_PHYS_BASE_STATE_TYPE
  USE CPG_OPTS_TYPE_MOD, ONLY: CPG_BNDS_TYPE, CPG_OPTS_TYPE
  USE MF_PHYS_TYPE_MOD, ONLY: MF_PHYS_TYPE
  USE FIELD_VARIABLES_MOD, ONLY: FIELD_VARIABLES
  USE TYPE_MODEL, ONLY: MODEL
  
  
  IMPLICIT NONE
  
  TYPE(MF_PHYS_BASE_STATE_TYPE), INTENT(IN) :: YDMF_PHYS_BASE_STATE
  TYPE(CPG_BNDS_TYPE), INTENT(IN) :: YDCPG_BNDS
  TYPE(CPG_OPTS_TYPE), INTENT(IN) :: YDCPG_OPTS
  TYPE(MF_PHYS_TYPE), INTENT(INOUT) :: YDMF_PHYS
  TYPE(FIELD_VARIABLES), INTENT(INOUT) :: YDVARS
  TYPE(MODEL), INTENT(IN) :: YDMODEL
  CLASS(FIELD_2IM), POINTER :: YD_KMOC_CLPH
  INTEGER(KIND=JPIM), POINTER :: KMOC_CLPH(:, :)
  CLASS(FIELD_2RB), POINTER :: YD_PBLH
  REAL(KIND=JPRB), POINTER :: PBLH(:, :)
  CLASS(FIELD_2RB), POINTER :: YD_PDCAPE
  REAL(KIND=JPRB), POINTER :: PDCAPE(:, :)
  
#include "accldia.intfb.h"
#include "accldia_openacc.intfb.h"
  
  REAL(KIND=JPHOOK) :: ZHOOK_HANDLE
  TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
  TYPE(STACK) :: YLSTACK
  INTEGER(KIND=JPIM) :: JBLK
  REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
  REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
  REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
  INTEGER(KIND=JPIM) :: JLON
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_TKE(:, :, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_U(:, :, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_V(:, :, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:, :, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_CAPE(:, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_UCLS(:, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_UGST(:, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_VCLS(:, :)
  REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_VGST(:, :)
  REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_OROG_T0(:, :)
  
  IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST', 0, ZHOOK_HANDLE)
  IF (LHOOK) CALL DR_HOOK('CREATE_TEMPORARIES', 0, ZHOOK_HANDLE_FIELD_API)
  
  IF (LHOOK) CALL DR_HOOK('CREATE_TEMPORARIES', 1, ZHOOK_HANDLE_FIELD_API)
  
  ! WIND GUST COMPUTATION
  IF (YDMODEL%YRML_PHY_MF%YRPHY2%LRAFTKE) THEN
    
    IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA', 0, ZHOOK_HANDLE_PARALLEL)
    IF (LPARALLELMETHOD('OPENMP', 'APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_HOST_DATA_RDWR(YD_KMOC_CLPH)
      PBLH => GET_HOST_DATA_RDWR(YD_PBLH)
      PDCAPE => GET_HOST_DATA_RDWR(YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 1, ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 0, ZHOOK_HANDLE_COMPUTE)
      CALL YLCPG_BNDS%INIT(YDCPG_OPTS)
!$OMP PARALLEL DO PRIVATE( JBLK ) FIRSTPRIVATE( YLCPG_BNDS )
      DO JBLK=YDCPG_OPTS%JBLKMIN,YDCPG_OPTS%JBLKMAX
        CALL YLCPG_BNDS%UPDATE(JBLK)
        
        Z_YDMF_PHYS_OUT_CAPE(:, JBLK) = 0._JPRB
        PDCAPE(:, JBLK) = 0._JPRB
        CALL ACCLDIA(YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL%YRML_PHY_MF%YRPHY,  &
        & YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON,  &
        & YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK), Z_YDMF_PHYS_OUT_VCLS(:, JBLK),  &
        & Z_YDMF_PHYS_BASE_STATE_U(:, :, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:, :, JBLK), Z_YDMF_PHYS_OUT_CAPE(:, JBLK),  &
        & PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:, :, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:, :, JBLK),  &
        & Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST(:, JBLK), PBLH(:, JBLK),  &
        & KMOC_CLPH(:, JBLK))
        
      END DO
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 1, ZHOOK_HANDLE_COMPUTE)
      IF (LSYNCHOST('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 0, ZHOOK_HANDLE_FIELD_API)
        KMOC_CLPH => GET_HOST_DATA_RDWR(YD_KMOC_CLPH)
        PBLH => GET_HOST_DATA_RDWR(YD_PBLH)
        PDCAPE => GET_HOST_DATA_RDWR(YD_PDCAPE)
        Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
        Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
        Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
        Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
        Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
        Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
        Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
        Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
        Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
        Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 1, ZHOOK_HANDLE_FIELD_API)
      END IF
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => NULL()
      PBLH => NULL()
      PDCAPE => NULL()
      Z_YDMF_PHYS_BASE_STATE_TKE => NULL()
      Z_YDMF_PHYS_BASE_STATE_U => NULL()
      Z_YDMF_PHYS_BASE_STATE_V => NULL()
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL()
      Z_YDMF_PHYS_OUT_CAPE => NULL()
      Z_YDMF_PHYS_OUT_UCLS => NULL()
      Z_YDMF_PHYS_OUT_UGST => NULL()
      Z_YDMF_PHYS_OUT_VCLS => NULL()
      Z_YDMF_PHYS_OUT_VGST => NULL()
      Z_YDVARS_GEOMETRY_OROG_T0 => NULL()
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 1, ZHOOK_HANDLE_FIELD_API)
    ELSE IF (LPARALLELMETHOD('OPENMPSINGLECOLUMN', 'APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_HOST_DATA_RDWR(YD_KMOC_CLPH)
      PBLH => GET_HOST_DATA_RDWR(YD_PBLH)
      PDCAPE => GET_HOST_DATA_RDWR(YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 1, ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 0, ZHOOK_HANDLE_COMPUTE)
!$OMP PARALLEL DO PRIVATE( JBLK, JLON, YLCPG_BNDS, YLSTACK )
      DO JBLK=YDCPG_OPTS%JBLKMIN,YDCPG_OPTS%JBLKMAX
        DO JLON=1,MIN(YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1)*YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JLON
          YLCPG_BNDS%KFDIA = JLON
          YLSTACK%L8 = stack_l8(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U8 = stack_u8(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%L4 = stack_l4(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U4 = stack_u4(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          
          Z_YDMF_PHYS_OUT_CAPE(JLON, JBLK) = 0._JPRB
          PDCAPE(JLON, JBLK) = 0._JPRB
          CALL ACCLDIA_OPENACC(YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST,  &
          & YDMODEL%YRML_PHY_MF%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA,  &
          & YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK),  &
          & Z_YDMF_PHYS_OUT_VCLS(:, JBLK), Z_YDMF_PHYS_BASE_STATE_U(:, :, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:, :, JBLK),  &
          & Z_YDMF_PHYS_OUT_CAPE(:, JBLK), PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:, :, JBLK),  &
          & Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:, :, JBLK), Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK),  &
          & Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST(:, JBLK), PBLH(:, JBLK), KMOC_CLPH(:, JBLK), YDSTACK=YLSTACK)
          
        END DO
      END DO
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 1, ZHOOK_HANDLE_COMPUTE)
      IF (LSYNCHOST('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 0, ZHOOK_HANDLE_FIELD_API)
        KMOC_CLPH => GET_HOST_DATA_RDWR(YD_KMOC_CLPH)
        PBLH => GET_HOST_DATA_RDWR(YD_PBLH)
        PDCAPE => GET_HOST_DATA_RDWR(YD_PDCAPE)
        Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
        Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
        Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
        Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
        Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
        Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
        Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
        Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
        Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
        Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 1, ZHOOK_HANDLE_FIELD_API)
      END IF
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => NULL()
      PBLH => NULL()
      PDCAPE => NULL()
      Z_YDMF_PHYS_BASE_STATE_TKE => NULL()
      Z_YDMF_PHYS_BASE_STATE_U => NULL()
      Z_YDMF_PHYS_BASE_STATE_V => NULL()
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL()
      Z_YDMF_PHYS_OUT_CAPE => NULL()
      Z_YDMF_PHYS_OUT_UCLS => NULL()
      Z_YDMF_PHYS_OUT_UGST => NULL()
      Z_YDMF_PHYS_OUT_VCLS => NULL()
      Z_YDMF_PHYS_OUT_VGST => NULL()
      Z_YDVARS_GEOMETRY_OROG_T0 => NULL()
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 1, ZHOOK_HANDLE_FIELD_API)
    ELSE IF (LPARALLELMETHOD('OPENACCSINGLECOLUMN', 'APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_DEVICE_DATA_RDWR(YD_KMOC_CLPH)
      PBLH => GET_DEVICE_DATA_RDWR(YD_PBLH)
      PDCAPE => GET_DEVICE_DATA_RDWR(YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_DEVICE_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_DEVICE_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_DEVICE_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_DEVICE_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_DEVICE_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_DEVICE_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_DEVICE_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_DEVICE_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_DEVICE_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_DEVICE_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA', 1, ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 0, ZHOOK_HANDLE_COMPUTE)
!$ACC PARALLEL LOOP GANG PRESENT( KMOC_CLPH, PBLH, PDCAPE, YDCPG_OPTS, YDMODEL, YSTACK, Z_YDMF_PHYS_BASE_STATE_TKE,  &
!$ACC & Z_YDMF_PHYS_BASE_STATE_U, Z_YDMF_PHYS_BASE_STATE_V, Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF, Z_YDMF_PHYS_OUT_CAPE,  &
!$ACC & Z_YDMF_PHYS_OUT_UCLS, Z_YDMF_PHYS_OUT_UGST, Z_YDMF_PHYS_OUT_VCLS, Z_YDMF_PHYS_OUT_VGST, Z_YDVARS_GEOMETRY_OROG_T0 )  &
!$ACC & PRIVATE( JBLK ) VECTOR_LENGTH( YDCPG_OPTS%KLON )
      DO JBLK=YDCPG_OPTS%JBLKMIN,YDCPG_OPTS%JBLKMAX
!$ACC LOOP VECTOR PRIVATE( JLON, YLCPG_BNDS, YLSTACK )
        DO JLON=1,MIN(YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1)*YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JLON
          YLCPG_BNDS%KFDIA = JLON
          YLSTACK%L8 = stack_l8(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U8 = stack_u8(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%L4 = stack_l4(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          YLSTACK%U4 = stack_u4(YSTACK, JBLK - YDCPG_OPTS%JBLKMIN + 1, YDCPG_OPTS%KGPBLKS)
          
          Z_YDMF_PHYS_OUT_CAPE(JLON, JBLK) = 0._JPRB
          PDCAPE(JLON, JBLK) = 0._JPRB
          CALL ACCLDIA_OPENACC(YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST,  &
          & YDMODEL%YRML_PHY_MF%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA,  &
          & YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK),  &
          & Z_YDMF_PHYS_OUT_VCLS(:, JBLK), Z_YDMF_PHYS_BASE_STATE_U(:, :, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:, :, JBLK),  &
          & Z_YDMF_PHYS_OUT_CAPE(:, JBLK), PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:, :, JBLK),  &
          & Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:, :, JBLK), Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK),  &
          & Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST(:, JBLK), PBLH(:, JBLK), KMOC_CLPH(:, JBLK), YDSTACK=YLSTACK)
          
        END DO
      END DO
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE', 1, ZHOOK_HANDLE_COMPUTE)
      IF (LSYNCHOST('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 0, ZHOOK_HANDLE_FIELD_API)
        KMOC_CLPH => GET_HOST_DATA_RDWR(YD_KMOC_CLPH)
        PBLH => GET_HOST_DATA_RDWR(YD_PBLH)
        PDCAPE => GET_HOST_DATA_RDWR(YD_PDCAPE)
        Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_TKE)
        Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_U)
        Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%F_V)
        Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR(YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
        Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_CAPE)
        Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UCLS)
        Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_UGST)
        Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VCLS)
        Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR(YDMF_PHYS%OUT%F_VGST)
        Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR(YDVARS%GEOMETRY%OROG%FT0)
        IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST', 1, ZHOOK_HANDLE_FIELD_API)
      END IF
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 0, ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => NULL()
      PBLH => NULL()
      PDCAPE => NULL()
      Z_YDMF_PHYS_BASE_STATE_TKE => NULL()
      Z_YDMF_PHYS_BASE_STATE_U => NULL()
      Z_YDMF_PHYS_BASE_STATE_V => NULL()
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL()
      Z_YDMF_PHYS_OUT_CAPE => NULL()
      Z_YDMF_PHYS_OUT_UCLS => NULL()
      Z_YDMF_PHYS_OUT_UGST => NULL()
      Z_YDMF_PHYS_OUT_VCLS => NULL()
      Z_YDMF_PHYS_OUT_VGST => NULL()
      Z_YDVARS_GEOMETRY_OROG_T0 => NULL()
      IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY', 1, ZHOOK_HANDLE_FIELD_API)
    END IF
    IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST_PARALLEL:ACCLDIA', 1, ZHOOK_HANDLE_PARALLEL)
    
  END IF
  
  IF (LHOOK) CALL DR_HOOK('DELETE_TEMPORARIES', 0, ZHOOK_HANDLE_FIELD_API)
  
  IF (LHOOK) CALL DR_HOOK('DELETE_TEMPORARIES', 1, ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK('APL_WIND_GUST', 1, ZHOOK_HANDLE)
  
END SUBROUTINE APL_WIND_GUST_PARALLEL
